<app-peg-menu></app-peg-menu>

<div class="container">
  <div class="row w-100">
    <div class="col-12">

      <div class="row">
        <h2 class="border-bottom border-primary-peg">Obbiettivi straordinari</h2>
      </div>

      <div class="row my-2">
        <div class="col-4">
          <p class="small my-0 py-0"><small>Anno</small></p>
          <input id="year" type="number" class="col-2 w-100 form-control">
        </div>

        <div class="col-4">
          <p class="small my-0 py-0"><small>Responsabile</small></p>
          <select name="office" class="col-2 form-control text-white" (change)="changeResponsable()" [(ngModel)]="selectedResponsable">
            <option *ngFor="let r of this.responsables" [ngValue]="r">{{r.name}} {{r.surname}}</option>
          </select>
        </div>

        <div class="col-4">
          <p class="small my-0 py-0"><small>Ufficio</small></p>
          <select name="office" class="col-2 form-control text-white">
            <option *ngFor="let o of this.selectedOffices" value="o[0]">{{o[1]}}</option>
          </select>
        </div>
        
      </div>


      <div class="row m-0 border-bottom border-muted-peg  pb-1">
        <div class="col-5 m-0 p-0">
            <p class="small my-0 py-0"><small>Nome</small></p>
        </div>
        <div class="col-1">
          <p class="small my-0 py-0"><small>Peso</small></p>
        </div>
        <div class="col-1">
            <p class="small my-0 py-0"><small>% 30/06</small></p>
        </div>
        <div class="col-1">
            <p class="small my-0 py-0"><small>Peso</small></p>
        </div>
        <div class="col-1">
            <p class="small my-0 py-0"><small>% 31/12</small></p>
        </div>
        <div class="col-1">
            <p class="small my-0 py-0"><small></small></p>
        </div>
    </div>

      <app-peg-goal *ngFor="let goal of this.goalList; index as i" [inputGoal]="goal" (goalUpdated)="updateGoal($event, i)"></app-peg-goal>

      <!-- <form [formGroup]="goalForm" (ngSubmit)="submit()" class="">

        <div class="row m-0">
          <h2 class="border-bottom border-primary-peg">Obbiettivi straordinario</h2>
        </div>

        <div class="row border-bottom-muted">

          <div class="col-11 border-right">
            <div class="row m-0">
              <div class="col-4">
                <p class="mb-0 pb-0">Nome</p>
                <input formControlName="name" id="name" type="text" class="form-control">
              </div>
    
              <div class="col-4">
                <p class="mb-0 pb-0">Ufficio</p>
                <div class="d-flex justify-content-between">
                  <span>{{goal.office}}</span>
                  <div class="btn btn border-primary-peg text-primary-peg" (click)="changeOffice()"><fa-icon [icon]='faPen' class="icon-bg m-0"></fa-icon></div>
                </div>
                <!-- <input formControlName="name" id="name" type="text" class="form-control"> --
              </div>
    
              <div class="col-4">
                <p class="mb-0 pb-0">Responsabile</p>
                <div class="d-flex justify-content-between">
                  <span>{{goal.responsable}}</span>
                  <div class="btn border-primary-peg text-primary-peg" (click)="ChangeResponsable()"><fa-icon [icon]='faPen' class="icon-bg m-0"></fa-icon></div>
                </div>
                <!-- <input formControlName="responsable" id="responsable" type="text" class="form-control"> --
              </div>
          
            </div>
    
            <div class="row m-0">
    
              <div class="col-6">
                <p class="mb-0 pb-0">Descrizione</p>
                <textarea formControlName="description" id="description" type="textarea" rows="3" class="form-control"></textarea>
              </div>
    
              <div class="col-6">
                <p class="mb-0 pb-0">Persone</p>
                <div class="row">
                  <span class="d-flex w-auto" *ngFor="let person of this.involved">{{person.name}} {{person.surname}} 
                    <div class="circle border border-secondary-peg text-secondary-peg mx-1 me-2" (click)="removeInvolvedPeople(person)"><fa-icon [icon]='faMinus' class="m-0"></fa-icon></div>
                  </span>
                </div>
                <div class="d-flex justify-content-between">
                  <input #searchInput id="" type="text" class="w-100 form-control me-3" (focus)="focus()" (input)="onSearchPAUser($event)">
                  <div class="btn border-primary-peg text-primary-peg"><fa-icon [icon]='faSearch' class="icon-bg m-0"></fa-icon></div>
                </div>
              

                <div *ngIf="this.searching === true" [ngClass]="{'py-2': this.searching}"  class="search-results rounded px-3 mt-2">
                  <div *ngFor="let person of filteredPAUserList" class="d-flex justify-content-between align-items-center border-bottom border-muted py-1 mb-1" (click)="addInvolvedPeople(person)">
                    <span class=""> {{person.name}} {{person.surname}}</span>
                    <div class="text-primary-peg"><fa-icon [icon]='faPlus' class="m-0"></fa-icon></div>
                  </div>
                </div>
              </div>
    
    
            </div>
    
          </div>

          <div class="col-1">
            <p class="mb-0 pb-0">Peso</p>
            <input formControlName="weight" id="weight" type="number" class="form-control">
          </div>

        </div>

        
<!-- 
        <div class="row m-0 mt-3">
          <div class="col-8 justify-content-between">
            <div *ngFor="let person of this.userList; index as i" class="col-3 d-flex justify-content-between">
              <div class="">{{person.name}} {{person.surname}}</div>
              <div *ngIf="person?.added == false || person?.added == null"
                class="circle border border-primary-peg text-white cursor" (click)="addInvolvedPeople(person)">
                <small><fa-icon [icon]='faPlus' class=""></fa-icon></small></div>
              <div *ngIf="person?.added == true" class="circle bg-primary-peg cursor"
                (click)="removeInvolvedPeople(person)"><small><fa-icon [icon]='faMinus' class=""></fa-icon></small>
              </div>
            </div>
            <div class="d-flex">
              Persone coinvolte: <span *ngFor="let person of this.involved">{{person.name}} {{person.surname}}</span>
            </div>
          </div>
        </div>
 --


        <div class="row justify-content-end">
          <button class="w-auto h-2 rounded border-0 bg-primary-peg mx-2" value="Submit" (click)="submit()">Salva</button>
        </div>

      </form>
 -->

      <div class="row justify-content-end border-top border-primary-peg pt-3 mt-3">
        <button class="w-auto h-2 rounded border-0 bg-secondary-peg bg-dark text-white mx-2"
          (click)="openInstructions(instructionModal)">Istruzioni</button>
        <button class="w-auto h-2 rounded border-0 bg-primary-peg mx-2" (click)="addGoal()">Aggiungi obbiettivo</button>
        <button class="w-auto h-2 rounded border-0 bg-primary-peg mx-2" (click)="saveGoals()">Salva</button>
      </div>

    </div>
  </div>
</div>



<ng-template #instructionModal>
  <div class="modal-body bg-dark px-5">
    <p><strong>Peso:</strong> {{pegInstructions.weight}}</p>
    <p><strong>% al 30/06:</strong> {{pegInstructions.percent_3006}}</p>
    <p><strong>Peso al 30/06:</strong> {{pegInstructions.weight_3006}}</p>
    <p><strong>% al 31/12:</strong> {{pegInstructions.percent_3112}}</p>
    <p><strong>Peso al 31/12:</strong> {{pegInstructions.weight_3112}}</p>


    <div class="row justify-content-center px-5 pt-4">
      <div class="w-auto btn bg-secondary-peg" (click)="modalRef?.hide()">Chiudi</div>
    </div>
  </div>
</ng-template>